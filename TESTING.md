# Felay æ‰‹åŠ¨æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£è¦†ç›– Felay æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½çš„æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤ã€‚

## å‰ææ¡ä»¶

ç¡®ä¿å·²å®Œæˆå®‰è£…ï¼š

```bash
git clone https://github.com/zqq-nuli/Felay.git
cd Felay
pnpm run setup    # å®‰è£…ä¾èµ– + ç¼–è¯‘ + å…¨å±€æ³¨å†Œ felay å‘½ä»¤
```

éªŒè¯å®‰è£…æˆåŠŸï¼š

```bash
felay --help
```

åº”æ˜¾ç¤º `Felay â€” Feishu CLI Proxy` å¸®åŠ©ä¿¡æ¯ã€‚

---

## æµ‹è¯• 1: åŸºç¡€ CLI + Daemon

éªŒè¯ CLI èƒ½å¯åŠ¨ PTY ä¼šè¯å¹¶æ³¨å†Œåˆ° Daemonã€‚

```bash
# 1. æ‰‹åŠ¨å¯åŠ¨ daemon
felay daemon start

# 2. æŸ¥çœ‹ daemon çŠ¶æ€
felay daemon status
# é¢„æœŸ: daemon running pid=XXXX sessions=0

# 3. å¯åŠ¨ä¸€ä¸ª PTY ä¼šè¯
felay run echo hello
# é¢„æœŸ: çœ‹åˆ° "hello" è¾“å‡ºï¼Œè¿›ç¨‹è‡ªåŠ¨é€€å‡º

# 4. å¯åŠ¨ä¸€ä¸ªæŒä¹…ä¼šè¯
felay run bash
# åœ¨ bash ä¸­è¾“å…¥å‡ æ¡å‘½ä»¤ï¼Œç¡®è®¤æ­£å¸¸äº¤äº’
# å¦å¼€ä¸€ä¸ªç»ˆç«¯:
felay daemon status
# é¢„æœŸ: sessions=1

# 5. é€€å‡º bashï¼ˆè¾“å…¥ exitï¼‰ï¼Œå›æ¥å†æŸ¥
felay daemon status
# é¢„æœŸ: sessions=0ï¼ˆæ´»è·ƒä¼šè¯æ¸…é›¶ï¼‰

# 6. åœæ­¢ daemon
felay daemon stop
# é¢„æœŸ: "daemon stopped"
```

**é€šè¿‡æ ‡å‡†:** æ‰€æœ‰å‘½ä»¤æ­£å¸¸æ‰§è¡Œï¼Œæ— æŠ¥é”™ã€‚

---

## æµ‹è¯• 2: CLI æ–­çº¿é‡è¿

éªŒè¯ Daemon å´©æºƒä¸å½±å“æœ¬åœ° PTYï¼Œé‡å¯åè‡ªåŠ¨æ¢å¤æ¡¥æ¥ã€‚

```bash
# ç»ˆç«¯ A:
felay run bash
# æ­£å¸¸ä½¿ç”¨ bash

# ç»ˆç«¯ B:
felay daemon stop
# è§‚å¯Ÿç»ˆç«¯ A çš„ stderr:
# é¢„æœŸ: "[felay] daemon connection lost. PTY continues locally."
# é¢„æœŸ: "[felay] daemon not available, retry 1/3"

# åœ¨ç»ˆç«¯ A ä¸­ç»§ç»­è¾“å…¥å‘½ä»¤ â†’ ç¡®è®¤ PTY ä¸å—å½±å“

# ç»ˆç«¯ B:
felay daemon start
# è§‚å¯Ÿç»ˆç«¯ A çš„ stderr:
# é¢„æœŸ: "[felay] reconnected to daemon"

# ç»ˆç«¯ B:
felay daemon status
# é¢„æœŸ: æ´»è·ƒä¼šè¯æ•°æ¢å¤ä¸º 1
```

**é€šè¿‡æ ‡å‡†:** PTY å§‹ç»ˆå¯äº¤äº’ï¼Œé‡è¿å daemon é‡æ–°æ˜¾ç¤ºè¯¥ä¼šè¯ã€‚

---

## æµ‹è¯• 3: GUI ç®¡ç†ç•Œé¢

éªŒè¯ GUI èƒ½æ­£å¸¸æ˜¾ç¤ºçŠ¶æ€å’Œç®¡ç†æœºå™¨äººã€‚

```bash
# ç¡®ä¿ daemon å·²è¿è¡Œ
felay daemon start

# å¯åŠ¨ GUIï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd Felay
pnpm dev:gui
```

åœ¨ GUI ä¸­éªŒè¯ï¼š

1. **Daemon çŠ¶æ€** â€” åº•éƒ¨çŠ¶æ€æ æ˜¾ç¤º "Daemon: è¿è¡Œä¸­"
2. **ä¼šè¯é¡µ** â€” å¦‚æœ‰æ´»è·ƒä¼šè¯ï¼Œåˆ—è¡¨ä¸­å¯è§
3. **æœºå™¨äººé¡µ** â€” ç‚¹å‡» "æ·»åŠ æ¨é€æœºå™¨äºº"ï¼Œå¡«å…¥åç§°å’Œä»»æ„ webhook åœ°å€ï¼Œä¿å­˜
4. **ç¼–è¾‘** â€” ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œç¡®è®¤ä¿¡æ¯å›æ˜¾æ­£ç¡®
5. **å¯†ç å¯è§** â€” App Secret / ç­¾åå¯†é’¥å­—æ®µæ—æœ‰ ğŸ‘ æŒ‰é’®å¯åˆ‡æ¢æ˜¾ç¤º
6. **åˆ é™¤** â€” åˆ é™¤åˆšæ·»åŠ çš„æœºå™¨äººï¼Œç¡®è®¤å¼¹çª—æç¤º
7. **è®¾ç½®é¡µ** â€” ä¿®æ”¹"é‡è¯•æ¬¡æ•°"ä¸º 5ï¼Œç‚¹å‡»ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢ç¡®è®¤æŒä¹…åŒ–
8. **æ¢å¤é»˜è®¤** â€” ç‚¹å‡»"æ¢å¤é»˜è®¤"ï¼Œç¡®è®¤æ•°å€¼è¿˜åŸ

**é€šè¿‡æ ‡å‡†:** æ‰€æœ‰ç•Œé¢æ“ä½œæ­£å¸¸ï¼Œæ— æ§åˆ¶å°æŠ¥é”™ã€‚

---

## æµ‹è¯• 4: å¯†é’¥åŠ å¯†å­˜å‚¨

éªŒè¯æœºå™¨äººå¯†é’¥åœ¨ç£ç›˜ä¸Šä»¥å¯†æ–‡å­˜å‚¨ã€‚

```bash
# åœ¨ GUI ä¸­æ·»åŠ ä¸€ä¸ªåŒå‘æœºå™¨äººï¼ˆå¡«å…¥ä»»æ„ App ID å’Œ App Secretï¼‰
# ç„¶åæ£€æŸ¥é…ç½®æ–‡ä»¶:

# Windows:
type %USERPROFILE%\.felay\config.json

# macOS/Linux:
cat ~/.felay/config.json
```

éªŒè¯ï¼š
- `appSecret` å­—æ®µå€¼ä»¥ `"enc:"` å¼€å¤´ï¼ˆéæ˜æ–‡ï¼‰
- `encryptKey` å­—æ®µï¼ˆå¦‚å¡«å†™ï¼‰ä¹Ÿä»¥ `"enc:"` å¼€å¤´
- `~/.felay/.master-key` æ–‡ä»¶å­˜åœ¨

```bash
# Windows:
dir %USERPROFILE%\.felay\.master-key

# macOS/Linux:
ls -la ~/.felay/.master-key
# é¢„æœŸ: æƒé™ä¸º -rw------- (600)
```

**é€šè¿‡æ ‡å‡†:** ç£ç›˜é…ç½®ä¸­æ‰€æœ‰å¯†é’¥å­—æ®µä¸º `enc:` å‰ç¼€å¯†æ–‡ã€‚

---

## æµ‹è¯• 5: é£ä¹¦åŒå‘æœºå™¨äºº

> éœ€è¦çœŸå®çš„é£ä¹¦åº”ç”¨ App ID / App Secretã€‚
> åœ¨[é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn)åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ï¼Œ
> å¯ç”¨"æœºå™¨äºº"èƒ½åŠ›ï¼Œè·å– App ID å’Œ App Secretã€‚

```bash
# 1. å¯åŠ¨ä¼šè¯
felay run bash

# 2. åœ¨ GUI ä¸­:
#    - æœºå™¨äººé¡µ â†’ æ·»åŠ åŒå‘æœºå™¨äººï¼ˆå¡«å…¥çœŸå® App ID + Secretï¼‰
#    - ç‚¹å‡»"æµ‹è¯•è¿æ¥"ç¡®è®¤å‡­æ®æœ‰æ•ˆ
#    - ä¼šè¯é¡µ â†’ ä¸ºæ´»è·ƒä¼šè¯ç»‘å®šè¯¥æœºå™¨äºº

# 3. åœ¨é£ä¹¦ä¸­:
#    - åœ¨æœºå™¨äººæ‰€åœ¨ç¾¤èŠä¸­å‘é€ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯
#    - é¢„æœŸ: CLI bash ä¸­å‡ºç°ä½ å‘é€çš„æ–‡æœ¬
#    - é¢„æœŸ: é£ä¹¦ç¾¤ä¸­æ”¶åˆ°å¸¦ç»ˆç«¯è¾“å‡ºçš„å¡ç‰‡å›å¤

# 4. é€€å‡º bashï¼ˆè¾“å…¥ exitï¼‰
#    - é¢„æœŸ: é£ä¹¦ç¾¤ä¸­æ”¶åˆ° "Task Summary" å¡ç‰‡ï¼ŒåŒ…å«æœ€åè¾“å‡ºå†…å®¹
```

**é€šè¿‡æ ‡å‡†:** é£ä¹¦æ¶ˆæ¯èƒ½è§¦å‘ CLI è¾“å…¥ï¼ŒCLI è¾“å‡ºèƒ½å›ä¼ é£ä¹¦ã€‚

---

## æµ‹è¯• 6: æ¨é€æœºå™¨äºº

> éœ€è¦é£ä¹¦ç¾¤æœºå™¨äºº Webhook åœ°å€ã€‚
> åœ¨é£ä¹¦ç¾¤è®¾ç½®ä¸­æ·»åŠ "è‡ªå®šä¹‰æœºå™¨äºº"è·å– Webhook URLã€‚

```bash
# 1. å¯åŠ¨ä¼šè¯
felay run bash

# 2. åœ¨ GUI ä¸­:
#    - æœºå™¨äººé¡µ â†’ æ·»åŠ æ¨é€æœºå™¨äººï¼ˆå¡«å…¥ Webhook åœ°å€å’Œå¯é€‰ç­¾åå¯†é’¥ï¼‰
#    - ç‚¹å‡»"å‘é€æµ‹è¯•æ¶ˆæ¯"ç¡®è®¤ Webhook æœ‰æ•ˆ
#    - ä¼šè¯é¡µ â†’ ä¸ºæ´»è·ƒä¼šè¯ç»‘å®šæ¨é€æœºå™¨äºº

# 3. åœ¨ bash ä¸­æ‰§è¡Œå‘½ä»¤äº§ç”Ÿè¾“å‡º:
echo "test push message from felay"
ls -la

# 4. ç­‰å¾… 2-3 ç§’ï¼ˆåˆå¹¶çª—å£é»˜è®¤ 2000msï¼‰
#    - é¢„æœŸ: é£ä¹¦ç¾¤æ”¶åˆ°åŒ…å«å‘½ä»¤è¾“å‡ºçš„æ¨é€å¡ç‰‡
```

**é€šè¿‡æ ‡å‡†:** CLI è¾“å‡ºè‡ªåŠ¨æ¨é€åˆ°é£ä¹¦ç¾¤ã€‚

---

## æµ‹è¯• 7: ç³»ç»Ÿæ‰˜ç›˜ï¼ˆGUI ç”Ÿäº§æ„å»ºï¼‰

> éœ€è¦å®Œæ•´æ„å»º Tauri åº”ç”¨ã€‚

```bash
pnpm build:gui
# å®‰è£…åŒ…è¾“å‡ºåœ¨ packages/gui/src-tauri/target/release/bundle/
# Windows: nsis/ ç›®å½•ä¸‹æœ‰ .exe å®‰è£…ç¨‹åº
```

å®‰è£…åéªŒè¯ï¼š
1. ç³»ç»Ÿæ‰˜ç›˜å‡ºç° Felay å›¾æ ‡
2. å³é”®èœå•æ˜¾ç¤º "Daemon: è¿è¡Œä¸­/æœªè¿è¡Œ" å’Œ "æ´»è·ƒä¼šè¯: N"
3. ç‚¹å‡»"æ‰“å¼€é¢æ¿"æ˜¾ç¤ºä¸»çª—å£
4. çŠ¶æ€æ¯ 5 ç§’è‡ªåŠ¨åˆ·æ–°

---

## å¸¸è§é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³ |
|------|------|------|
| `felay: command not found` | æœªå…¨å±€æ³¨å†Œ | è¿è¡Œ `pnpm setup` |
| `daemon entry not found` | æœªç¼–è¯‘ | è¿è¡Œ `pnpm build` |
| `node-pty` å®‰è£…å¤±è´¥ | ç¼ºå°‘ç¼–è¯‘å·¥å…· | Windows: `npm install -g windows-build-tools`; macOS: `xcode-select --install` |
| GUI å¯åŠ¨ç™½å± | å‰ç«¯æœªç¼–è¯‘ | ç¡®ä¿å…ˆè¿è¡Œ `pnpm build` |
| é£ä¹¦è¿æ¥å¤±è´¥ | å‡­æ®é”™è¯¯æˆ–ç½‘ç»œé—®é¢˜ | ç”¨"æµ‹è¯•è¿æ¥"åŠŸèƒ½æ’æŸ¥ |
